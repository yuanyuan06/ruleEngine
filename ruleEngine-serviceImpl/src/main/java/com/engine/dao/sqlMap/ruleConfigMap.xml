<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.engine.dao.RuleConfigDao">

    <select id="findAllRule" resultType="com.engine.entity.ruleEngine.RuleSnippet">
        SELECT
            id,
            doc_num docNum,
            script,
            description,
            create_time createTime,
            create_user createUser,
            version,
            last_modify_time lastModifyTime,
            last_modify_user lastModifyUser
        FROM rule_snippet
    </select>


    <select id="querySnippetGroupByStage" resultMap="stageCommand" >
        select
            t.doc_num stageNum
        from
            rule_stage t
    </select>
    
    <select id="querySnippetByStage" resultType="string">
        select
          r.snippet_num
        from
          stage_snippet_rel r
        where
          r.stage_num = #{stage_num}
        order by
          r.priority
    </select>

    <resultMap id="stageCommand" type="com.engine.command.StageSnippetCommand">
        <result property="stageNum" column="stageNum" />
        <collection property="snippetNums" column="stageNum" select="querySnippetByStage"/>
    </resultMap>



</mapper>